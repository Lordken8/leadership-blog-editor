<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leadership Blog Editor - Embedded</title>

    <!-- Quill.js CDN -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <style>
        /* Embedded Editor Configuration */
        :root {
            /* Configurable color scheme - can be overridden */
            --embed-primary: #1e40af;
            --embed-secondary: #64748b;
            --embed-accent: #f59e0b;
            --embed-success: #10b981;
            --embed-warning: #f59e0b;
            --embed-error: #ef4444;
            --embed-bg: #ffffff;
            --embed-border: #e5e7eb;
            --embed-text: #1f2937;
            --embed-width: 100%;
            --embed-height: 600px;
        }

        /* Reset and base styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--embed-bg);
            color: var(--embed-text);
            line-height: 1.6;
        }

        /* Embedded container */
        .embed-container {
            width: var(--embed-width);
            height: var(--embed-height);
            border: 1px solid var(--embed-border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--embed-bg);
        }

        /* Toolbar */
        .embed-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f8fafc;
            border-bottom: 1px solid var(--embed-border);
            flex-shrink: 0;
        }

        .embed-brand {
            font-weight: 600;
            color: var(--embed-primary);
            font-size: 14px;
        }

        .embed-actions {
            display: flex;
            gap: 8px;
        }

        .embed-btn {
            padding: 6px 12px;
            border: 1px solid var(--embed-border);
            border-radius: 4px;
            background: var(--embed-bg);
            color: var(--embed-text);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .embed-btn:hover {
            background: #f1f5f9;
            border-color: var(--embed-primary);
        }

        .embed-btn.primary {
            background: var(--embed-primary);
            color: white;
            border-color: var(--embed-primary);
        }

        .embed-btn.primary:hover {
            background: #1d4ed8;
        }

        /* Editor area */
        .embed-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .embed-meta {
            display: flex;
            gap: 12px;
            padding: 12px 16px;
            background: #fafbfc;
            border-bottom: 1px solid var(--embed-border);
        }

        .embed-input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid var(--embed-border);
            border-radius: 4px;
            font-size: 14px;
            background: var(--embed-bg);
        }

        .embed-input:focus {
            outline: none;
            border-color: var(--embed-primary);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.1);
        }

        /* Quill editor customization */
        .embed-quill {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .embed-quill .ql-container {
            flex: 1;
            font-size: 14px;
            line-height: 1.6;
            border: none;
        }

        .embed-quill .ql-editor {
            padding: 16px;
            min-height: 200px;
        }

        .embed-quill .ql-toolbar {
            border: none;
            border-bottom: 1px solid var(--embed-border);
            padding: 8px 16px;
        }

        /* Status bar */
        .embed-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            background: #f8fafc;
            border-top: 1px solid var(--embed-border);
            font-size: 12px;
            color: #64748b;
            flex-shrink: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .embed-meta {
                flex-direction: column;
                gap: 8px;
            }

            .embed-actions {
                flex-direction: column;
            }

            .embed-toolbar {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
            }
        }

        /* Hide elements for minimal embed */
        .embed-minimal .embed-toolbar,
        .embed-minimal .embed-meta,
        .embed-minimal .embed-status {
            display: none;
        }

        .embed-minimal .embed-quill .ql-toolbar {
            padding: 4px 8px;
        }

        /* Notification styles */
        .embed-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: 4px;
            color: white;
            font-size: 14px;
            z-index: 9999;
            animation: slideIn 0.3s ease;
        }

        .embed-notification.success { background: var(--embed-success); }
        .embed-notification.error { background: var(--embed-error); }
        .embed-notification.warning { background: var(--embed-warning); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="embed-container" id="embedContainer">
        <!-- Toolbar -->
        <div class="embed-toolbar">
            <div class="embed-brand" id="embedBrand">Leadership Blog Editor</div>
            <div class="embed-actions">
                <button class="embed-btn" id="embedExport">Export</button>
                <button class="embed-btn" id="embedCopy">Copy HTML</button>
                <button class="embed-btn primary" id="embedFlowtrack">Export for Flowtrack</button>
            </div>
        </div>

        <!-- Editor -->
        <div class="embed-editor">
            <!-- Metadata -->
            <div class="embed-meta">
                <input type="text" class="embed-input" id="embedTitle" placeholder="Article title...">
                <input type="text" class="embed-input" id="embedAuthor" placeholder="Author name...">
            </div>

            <!-- Quill Editor -->
            <div class="embed-quill" id="embedQuill"></div>

            <!-- Status -->
            <div class="embed-status">
                <span id="embedWordCount">0 words</span>
                <span id="embedStatus">Ready</span>
            </div>
        </div>
    </div>

    <!-- Quill.js -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <script>
        /**
         * Embedded Leadership Blog Editor
         * Lightweight, configurable version for iframe embedding
         */
        class EmbeddedBlogEditor {
            constructor(options = {}) {
                this.options = {
                    minimal: false,
                    toolbar: 'full', // 'full', 'basic', 'minimal'
                    brand: 'Leadership Blog Editor',
                    colors: {},
                    width: '100%',
                    height: '600px',
                    flowtrackMode: false,
                    ...options
                };

                this.quill = null;
                this.init();
            }

            init() {
                this.applyConfiguration();
                this.initializeQuill();
                this.setupEventListeners();
                this.updateStatus('Ready');
            }

            applyConfiguration() {
                // Apply custom colors
                if (this.options.colors) {
                    const root = document.documentElement;
                    Object.entries(this.options.colors).forEach(([key, value]) => {
                        root.style.setProperty(`--embed-${key}`, value);
                    });
                }

                // Apply dimensions
                const container = document.getElementById('embedContainer');
                container.style.width = this.options.width;
                container.style.height = this.options.height;

                // Apply minimal mode
                if (this.options.minimal) {
                    container.classList.add('embed-minimal');
                }

                // Apply branding
                document.getElementById('embedBrand').textContent = this.options.brand;
            }

            initializeQuill() {
                const toolbarOptions = this.getToolbarConfig();

                this.quill = new Quill('#embedQuill', {
                    theme: 'snow',
                    modules: {
                        toolbar: toolbarOptions
                    },
                    placeholder: 'Start writing...'
                });

                // Track changes
                this.quill.on('text-change', () => {
                    this.updateWordCount();
                    this.updateStatus('Editing...');
                });
            }

            getToolbarConfig() {
                const configs = {
                    minimal: [
                        ['bold', 'italic'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }]
                    ],
                    basic: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['link']
                    ],
                    full: [
                        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'align': [] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['blockquote', 'code-block'],
                        ['link', 'image'],
                        ['clean']
                    ]
                };

                return configs[this.options.toolbar] || configs.full;
            }

            setupEventListeners() {
                document.getElementById('embedExport').addEventListener('click', () => {
                    this.exportHTML();
                });

                document.getElementById('embedCopy').addEventListener('click', () => {
                    this.copyToClipboard();
                });

                document.getElementById('embedFlowtrack').addEventListener('click', () => {
                    this.exportForFlowtrack();
                });
            }

            updateWordCount() {
                const text = this.quill.getText();
                const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
                document.getElementById('embedWordCount').textContent = `${wordCount} words`;
            }

            updateStatus(status) {
                document.getElementById('embedStatus').textContent = status;
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `embed-notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            getArticleData() {
                return {
                    title: document.getElementById('embedTitle').value || 'Untitled Article',
                    author: document.getElementById('embedAuthor').value || '',
                    content: this.quill.getText(),
                    htmlContent: this.quill.root.innerHTML
                };
            }

            exportHTML() {
                const data = this.getArticleData();
                const html = this.generateStandardHTML(data);
                this.downloadFile(html, `${data.title}.html`, 'text/html');
                this.showNotification('Article exported as HTML');
            }

            exportForFlowtrack() {
                const data = this.getArticleData();
                const html = this.generateFlowtrackHTML(data);
                this.copyToClipboardText(html);
                this.showNotification('Clean HTML copied for Flowtrack.co');
            }

            copyToClipboard() {
                const data = this.getArticleData();
                const html = data.htmlContent;
                this.copyToClipboardText(html);
                this.showNotification('HTML content copied to clipboard');
            }

            generateStandardHTML(data) {
                return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${this.escapeHtml(data.title)}</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1, h2, h3 { color: #1f2937; margin-top: 2em; }
        h1 { border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5em; }
        .article-meta {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 2em;
            padding-bottom: 1em;
            border-bottom: 1px solid #e5e7eb;
        }
    </style>
</head>
<body>
    <article>
        <h1>${this.escapeHtml(data.title)}</h1>
        ${data.author ? `<div class="article-meta">By ${this.escapeHtml(data.author)}</div>` : ''}
        <div class="content">${data.htmlContent}</div>
    </article>
</body>
</html>`;
            }

            generateFlowtrackHTML(data) {
                // Clean HTML without editor classes and styling
                let cleanHTML = data.htmlContent;

                // Remove Quill-specific classes and attributes
                cleanHTML = cleanHTML.replace(/class="[^"]*ql-[^"]*"/g, '');
                cleanHTML = cleanHTML.replace(/class=""/g, '');
                cleanHTML = cleanHTML.replace(/\s+class\s*=\s*""/g, '');

                // Clean up extra whitespace
                cleanHTML = cleanHTML.replace(/\s+/g, ' ').trim();

                // Wrap in a clean container
                return `<article class="blog-post">
    <h1>${this.escapeHtml(data.title)}</h1>
    ${data.author ? `<p class="author">By ${this.escapeHtml(data.author)}</p>` : ''}
    <div class="content">
        ${cleanHTML}
    </div>
</article>`;
            }

            copyToClipboardText(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text);
                } else {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Public API for external configuration
            configure(options) {
                Object.assign(this.options, options);
                this.applyConfiguration();
            }

            getContent() {
                return this.getArticleData();
            }

            setContent(title, author, htmlContent) {
                document.getElementById('embedTitle').value = title || '';
                document.getElementById('embedAuthor').value = author || '';
                if (htmlContent) {
                    this.quill.root.innerHTML = htmlContent;
                }
                this.updateWordCount();
            }
        }

        // Initialize embedded editor
        let embeddedEditor;

        // Wait for DOM and Quill to be ready
        document.addEventListener('DOMContentLoaded', () => {
            function initEditor() {
                if (typeof Quill !== 'undefined') {
                    // Check for configuration from parent window or URL parameters
                    const urlParams = new URLSearchParams(window.location.search);
                    const config = {
                        minimal: urlParams.get('minimal') === 'true',
                        toolbar: urlParams.get('toolbar') || 'full',
                        brand: urlParams.get('brand') || 'Leadership Blog Editor',
                        width: urlParams.get('width') || '100%',
                        height: urlParams.get('height') || '600px'
                    };

                    // Allow parent window to configure
                    if (window.parent && window.parent.embeddedEditorConfig) {
                        Object.assign(config, window.parent.embeddedEditorConfig);
                    }

                    embeddedEditor = new EmbeddedBlogEditor(config);

                    // Make editor available globally for iframe communication
                    window.embeddedEditor = embeddedEditor;
                } else {
                    setTimeout(initEditor, 100);
                }
            }

            initEditor();
        });

        // Handle messages from parent window
        window.addEventListener('message', (event) => {
            if (event.data.type === 'configure' && embeddedEditor) {
                embeddedEditor.configure(event.data.config);
            }
            if (event.data.type === 'getContent' && embeddedEditor) {
                event.source.postMessage({
                    type: 'content',
                    data: embeddedEditor.getContent()
                }, event.origin);
            }
            if (event.data.type === 'setContent' && embeddedEditor) {
                embeddedEditor.setContent(
                    event.data.title,
                    event.data.author,
                    event.data.htmlContent
                );
            }
        });
    </script>
</body>
</html>